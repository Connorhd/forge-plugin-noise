/*! Copyright 2011 Trigger Corp. All rights reserved. */
(function(){var n={};var o={};n.config={modules:{logging:{level:"DEBUG"},parameters:{test:"hello"}}};n.config.uuid="UUID_HERE";o.listeners={};var q={};var i=[];var h=null;var a=false;var s=function(){if(i.length>0){if(!o.debug||window.catalystConnected){a=true;while(i.length>0){var t=i.shift();if(t[0]=="logging.log"){console.log(t[1].message)}o.priv.call.apply(o.priv,t)}a=false}else{h=setTimeout(s,500)}}};o.priv={call:function(A,z,y,u){if((!o.debug||window.catalystConnected||A==="internal.showDebugWarning")&&(i.length==0||a)){var t=n.tools.UUID();var w=true;if(A==="button.onClicked.addListener"||A==="message.toFocussed"){w=false}if(y||u){q[t]={success:y,error:u,onetime:w}}var v={callid:t,method:A,params:z};o.priv.send(v);if(window._forgeDebug){try{v.start=(new Date().getTime())/1000;window._forgeDebug.forge.APICall.apiRequest(v)}catch(x){}}}else{i.push(arguments);if(!h){h=setTimeout(s,500)}}},send:function(t){throw new Error("Forge error: missing bridge to privileged code")},receive:function(t){if(t.callid){if(typeof q[t.callid]===undefined){n.log("Nothing stored for call ID: "+t.callid)}var v=q[t.callid];var u=(typeof t.content==="undefined"?null:t.content);if(v&&v[t.status]){v[t.status](t.content)}if(v&&v.onetime){delete q[t.callid]}if(window._forgeDebug){try{t.end=(new Date().getTime())/1000;window._forgeDebug.forge.APICall.apiResponse(t)}catch(w){}}}else{if(t.event){if(o.listeners[t.event]){o.listeners[t.event].forEach(function(x){if(t.params){x(t.params)}else{x()}})}if(window._forgeDebug){try{t.start=(new Date().getTime())/1000;window._forgeDebug.forge.APICall.apiEvent(t)}catch(w){}}}}}};o.addEventListener=function(t,u){if(o.listeners[t]){o.listeners[t].push(u)}else{o.listeners[t]=[u]}};o.generateQueryString=function(u){if(!u){return""}if(!(u instanceof Object)){return new String(u).toString()}var v=[];var t=function(B,A){if(B instanceof Array){var y=0;for(var w in B){var z=(A?A:"")+"["+y+"]";y+=1;if(!B.hasOwnProperty(w)){continue}t(B[w],z)}}else{if(B instanceof Object){for(var w in B){if(!B.hasOwnProperty(w)){continue}var z=w;if(A){z=A+"["+w+"]"}t(B[w],z)}}else{v.push(encodeURIComponent(A)+"="+encodeURIComponent(B))}}};t(u);return v.join("&").replace("%20","+")};o.generateMultipartString=function(u,w){if(typeof u==="string"){return""}var v="";for(var t in u){if(!u.hasOwnProperty(t)){continue}v+="--"+w+"\r\n";v+='Content-Disposition: form-data; name="'+t.replace('"','\\"')+'"\r\n\r\n';v+=u[t].toString()+"\r\n"}return v},o.generateURI=function(u,t){var v="";if(u.indexOf("?")!==-1){v+=u.split("?")[1]+"&";u=u.split("?")[0]}v+=this.generateQueryString(t)+"&";v=v.substring(0,v.length-1);return u+(v?"?"+v:"")};o.disabledModule=function(t,u){var v="The '"+u+"' module is disabled for this app, enable it in your app config and rebuild in order to use this function";n.logging.error(v);t&&t({message:v,type:"UNAVAILABLE",subtype:"DISABLED_MODULE"})};n.enableDebug=function(){o.debug=true;o.priv.call("internal.showDebugWarning",{},null,null);o.priv.call("internal.hideDebugWarning",{},null,null)};setTimeout(function(){if(window.forge&&window.forge.debug){alert("Warning!\n\n'forge.debug = true;' is no longer supported\n\nUse 'forge.enableDebug();' instead.")}},3000);n.barcode={scan:function(u,t){o.priv.call("barcode.scan",{},u,t)}};n.button={setIcon:function(u,v,t){o.priv.call("button.setIcon",u,v,t)},setURL:function(u,v,t){o.priv.call("button.setURL",u,v,t)},onClicked:{addListener:function(t){o.priv.call("button.onClicked.addListener",null,t)}},setBadge:function(u,v,t){o.priv.call("button.setBadge",u,v,t)},setBadgeBackgroundColor:function(u,v,t){o.priv.call("button.setBadgeBackgroundColor",u,v,t)},setTitle:function(v,u,t){o.priv.call("button.setTitle",v,u,t)}};n.contact={select:function(u,t){o.priv.call("contact.select",{},u,t)}};n.display={orientation:{forcePortrait:function(u,t){o.priv.call("display.orientation.forcePortrait",{},u,t)},forceLandscape:function(u,t){o.priv.call("display.orientation.forceLandscape",{},u,t)},allowAny:function(u,t){o.priv.call("display.orientation.allowAny",{},u,t)}}};n.document={reload:function(){return document.location.reload()},location:function(u,t){u(document.location)}};n.event={menuPressed:{addListener:function(u,t){o.addEventListener("menuPressed",u)}},messagePushed:{addListener:function(u,t){o.addEventListener("event.messagePushed",u)}},orientationChange:{addListener:function(u,t){o.addEventListener("event.orientationChange",u);if(nullObj&&o.currentOrientation!==nullObj){o.priv.receive({event:"event.orientationChange"})}}},connectionStateChange:{addListener:function(u,t){o.addEventListener("event.connectionStateChange",u);if(nullObj&&o.currentConnectionState!==nullObj){o.priv.receive({event:"event.connectionStateChange"})}}},appPaused:{addListener:function(u,t){o.addEventListener("event.appPaused",u)}},appResumed:{addListener:function(u,t){o.addEventListener("event.appResumed",u)}}};n.facebook={authorize:function(u,v,t){if(typeof u=="function"){t=v;v=u;u=[]}o.priv.call("facebook.authorize",{permissions:u},v,t)},logout:function(u,t){o.priv.call("facebook.logout",{},u,t)},api:function(v,y,x,w,t){if(typeof y=="function"||arguments.length==1){t=x;w=y;y="GET";x={}}else{if(typeof x=="function"||arguments.length==2){t=w;w=x;x=y;y="GET"}}if(x){for(var u in x){x[u]=String(x[u])}}o.priv.call("facebook.api",{path:v,method:y,params:x},w,t)},ui:function(v,u,t){o.priv.call("facebook.ui",v,u,t)}};n.file={getImage:function(u,v,t){if(typeof u==="function"){t=v;v=u;u={}}if(!u){u={}}o.priv.call("file.getImage",u,v&&function(x){var w={uri:x,name:"Image",type:"image"};if(u.width){w.width=u.width}if(u.height){w.height=u.height}v(w)},t)},getVideo:function(u,v,t){if(typeof u==="function"){t=v;v=u;u={}}if(!u){u={}}o.priv.call("file.getVideo",u,v&&function(x){var w={uri:x,name:"Video",type:"video"};v(w)},t)},getLocal:function(u,v,t){n.tools.getURL(u,function(w){v({uri:w,name:u})},t)},base64:function(u,v,t){o.priv.call("file.base64",u,v,t)},string:function(u,v,t){n.request.ajax({url:u.uri,success:v,error:t})},URL:function(v,w,x,u){if(typeof w==="function"){u=x;x=w}var t={};for(prop in v){t[prop]=v[prop]}t.height=w.height||v.height||undefined;t.width=w.width||v.width||undefined;o.priv.call("file.URL",t,x,u)},isFile:function(u,v,t){if(!u||!("uri" in u)){v(false)}else{o.priv.call("file.isFile",u,v,t)}},cacheURL:function(u,v,t){o.priv.call("file.cacheURL",{url:u},v&&function(w){v({uri:w})},t)},remove:function(u,v,t){o.priv.call("file.remove",u,v,t)},clearCache:function(u,t){o.priv.call("file.clearCache",{},u,t)}};n.internal={ping:function(u,v,t){o.priv.call("internal.ping",{data:[u]},v,t)},call:o.priv.call};n.is={mobile:function(){return false},desktop:function(){return false},android:function(){return false},ios:function(){return false},chrome:function(){return false},firefox:function(){return false},safari:function(){return false},ie:function(){return false},web:function(){return false},orientation:{portrait:function(){return false},landscape:function(){return false}},connection:{connected:function(){return true},wifi:function(){return true}}};var j=function(z,x,A){var v=[];stylize=function(C,B){return C};function t(B){return B instanceof RegExp||(typeof B==="object"&&Object.prototype.toString.call(B)==="[object RegExp]")}function u(B){return B instanceof Array||Array.isArray(B)||(B&&B!==Object.prototype&&u(B.__proto__))}function w(D){if(D instanceof Date){return true}if(typeof D!=="object"){return false}var B=Date.prototype&&Object.getOwnPropertyNames(Date.prototype);var C=D.__proto__&&Object.getOwnPropertyNames(D.__proto__);return JSON.stringify(C)===JSON.stringify(B)}function y(N,K){try{if(N&&typeof N.inspect==="function"&&!(N.constructor&&N.constructor.prototype===N)){return N.inspect(K)}switch(typeof N){case"undefined":return stylize("undefined","undefined");case"string":var B="'"+JSON.stringify(N).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return stylize(B,"string");case"number":return stylize(""+N,"number");case"boolean":return stylize(""+N,"boolean")}if(N===null){return stylize("null","null")}if(N instanceof Document){return(new XMLSerializer()).serializeToString(N)}var H=Object.keys(N);var O=x?Object.getOwnPropertyNames(N):H;if(typeof N==="function"&&O.length===0){var C=N.name?": "+N.name:"";return stylize("[Function"+C+"]","special")}if(t(N)&&O.length===0){return stylize(""+N,"regexp")}if(w(N)&&O.length===0){return stylize(N.toUTCString(),"date")}var D,L,I;if(u(N)){L="Array";I=["[","]"]}else{L="Object";I=["{","}"]}if(typeof N==="function"){var G=N.name?": "+N.name:"";D=" [Function"+G+"]"}else{D=""}if(t(N)){D=" "+N}if(w(N)){D=" "+N.toUTCString()}if(O.length===0){return I[0]+D+I[1]}if(K<0){if(t(N)){return stylize(""+N,"regexp")}else{return stylize("[Object]","special")}}v.push(N);var F=O.map(function(Q){var P,R;if(N.__lookupGetter__){if(N.__lookupGetter__(Q)){if(N.__lookupSetter__(Q)){R=stylize("[Getter/Setter]","special")}else{R=stylize("[Getter]","special")}}else{if(N.__lookupSetter__(Q)){R=stylize("[Setter]","special")}}}if(H.indexOf(Q)<0){P="["+Q+"]"}if(!R){if(v.indexOf(N[Q])<0){if(K===null){R=y(N[Q])}else{R=y(N[Q],K-1)}if(R.indexOf("\n")>-1){if(u(N)){R=R.split("\n").map(function(S){return"  "+S}).join("\n").substr(2)}else{R="\n"+R.split("\n").map(function(S){return"   "+S}).join("\n")}}}else{R=stylize("[Circular]","special")}}if(typeof P==="undefined"){if(L==="Array"&&Q.match(/^\d+$/)){return R}P=JSON.stringify(""+Q);if(P.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){P=P.substr(1,P.length-2);P=stylize(P,"name")}else{P=P.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");P=stylize(P,"string")}}return P+": "+R});v.pop();var M=0;var E=F.reduce(function(P,Q){M++;if(Q.indexOf("\n")>=0){M++}return P+Q.length+1},0);if(E>50){F=I[0]+(D===""?"":D+"\n ")+" "+F.join(",\n  ")+" "+I[1]}else{F=I[0]+D+" "+F.join(", ")+" "+I[1]}return F}catch(J){return"[No string representation]"}}return y(z,(typeof A==="undefined"?2:A))};var b=function(u,v){if("logging" in n.config){var t=n.config.logging.marker||"FORGE"}else{var t="FORGE"}u="["+t+"] "+(u.indexOf("\n")===-1?"":"\n")+u;o.priv.call("logging.log",{message:u,level:v});if(typeof console!=="undefined"){switch(v){case 10:if(console.debug!==undefined&&!(console.debug.toString&&console.debug.toString().match("alert"))){console.debug(u)}break;case 30:if(console.warn!==undefined&&!(console.warn.toString&&console.warn.toString().match("alert"))){console.warn(u)}break;case 40:case 50:if(console.error!==undefined&&!(console.error.toString&&console.error.toString().match("alert"))){console.error(u)}break;default:case 20:if(console.info!==undefined&&!(console.info.toString&&console.info.toString().match("alert"))){console.info(u)}break}}};var m=function(t,u){if(t in n.logging.LEVELS){return n.logging.LEVELS[t]}else{n.logging.__logMessage("Unknown configured logging level: "+t);return u}};var r=function(u){var x=function(y){if(y.message){return y.message}else{if(y.description){return y.description}else{return""+y}}};if(u){var w="\nError: "+x(u);try{if(u.lineNumber){w+=" on line number "+u.lineNumber}if(u.fileName){var t=u.fileName;w+=" in file "+t.substr(t.lastIndexOf("/")+1)}}catch(v){}if(u.stack){w+="\r\nStack trace:\r\n"+u.stack}return w}return""};n.logging={LEVELS:{ALL:0,DEBUG:10,INFO:20,WARNING:30,ERROR:40,CRITICAL:50},debug:function(u,t){n.logging.log(u,t,n.logging.LEVELS.DEBUG)},info:function(u,t){n.logging.log(u,t,n.logging.LEVELS.INFO)},warning:function(u,t){n.logging.log(u,t,n.logging.LEVELS.WARNING)},error:function(u,t){n.logging.log(u,t,n.logging.LEVELS.ERROR)},critical:function(u,t){n.logging.log(u,t,n.logging.LEVELS.CRITICAL)},log:function(u,t,x){if(typeof(x)==="undefined"){var x=n.logging.LEVELS.INFO}try{var v=m(n.config.logging.level,n.logging.LEVELS.ALL)}catch(w){var v=n.logging.LEVELS.ALL}if(x>=v){b(j(u,false,10)+r(t),x)}}};n.media={videoPlay:function(u,v,t){if(!u.uri){u={uri:u}}o.priv.call("media.videoPlay",u,v,t)}};n.message={listen:function(u,v,t){t&&t({message:"Forge Error: message.listen must be overridden by platform specific code",type:"UNAVAILABLE"})},broadcast:function(u,v,w,t){t&&t({message:"Forge Error: message.broadcast must be overridden by platform specific code",type:"UNAVAILABLE"})},broadcastBackground:function(u,v,w,t){t&&t({message:"Forge Error: message.broadcastBackground must be overridden by platform specific code",type:"UNAVAILABLE"})},toFocussed:function(u,v,w,t){o.priv.call("message.toFocussed",{type:u,content:v},w,t)}};n.notification={create:function(w,v,u,t){o.priv.call("notification.create",{title:w,text:v},u,t)}};n.payments={purchaseProduct:function(u,v,t){o.disabledModule(t,"payments")},restoreTransactions:function(u,t){o.disabledModule(t,"payments")},transactionReceived:{addListener:function(u,t){o.disabledModule(t,"payments")}}};n.prefs={get:function(u,v,t){o.disabledModule(t,"prefs")},set:function(u,v,w,t){o.disabledModule(t,"prefs")},keys:function(u,t){o.disabledModule(t,"prefs")},all:function(u,t){o.disabledModule(t,"prefs")},clear:function(u,v,t){o.disabledModule(t,"prefs")},clearAll:function(u,t){o.disabledModule(t,"prefs")}};n.reload={updateAvailable:function(u,t){o.priv.call("reload.updateAvailable",{},u,t)},update:function(u,t){o.priv.call("reload.update",{},u,t)},applyNow:function(u,t){o.priv.call("reload.applyNow",{},u,t)},switchStream:function(u,v,t){o.priv.call("reload.switchStream",{streamid:u},v,t)},updateReady:{addListener:function(u,t){o.addEventListener("reload.updateReady",u)}}};n.request={get:function(u,v,t){n.request.ajax({url:u,dataType:"text",success:v&&function(){try{arguments[0]=JSON.parse(arguments[0])}catch(w){}v.apply(this,arguments)},error:t})}};n.sms={send:function(w,v,t){if(w.to&&typeof w.to=="string"){w.to=[w.to]}var u={body:w.body||"",to:w.to||[]};o.priv.call("sms.send",u,v,t)}};n.tabbar={show:function(u,t){o.priv.call("tabbar.show",{},u,t)},hide:function(u,t){o.priv.call("tabbar.hide",{},u,t)},addButton:function(v,u,t){if(v.icon&&v.icon[0]==="/"){v.icon=v.icon.substr(1)}o.priv.call("tabbar.addButton",v,function(w){u&&u({remove:function(y,x){o.priv.call("tabbar.removeButton",{id:w},y,x)},setActive:function(y,x){o.priv.call("tabbar.setActive",{id:w},y,x)},onPressed:{addListener:function(y,x){o.addEventListener("tabbar.buttonPressed."+w,y)}}})},t)},removeButtons:function(u,t){o.priv.call("tabbar.removeButtons",{},u,t)},setTint:function(t,v,u){o.priv.call("tabbar.setTint",{color:t},v,u)},setActiveTint:function(t,v,u){o.priv.call("tabbar.setActiveTint",{color:t},v,u)},setInactive:function(u,t){o.priv.call("tabbar.setInactive",{},u,t)}};var l=function(x){if(x=="<all_urls>"){x="*://*"}x=x.split("://");var t=x[0];var v,w;if(x[1].indexOf("/")===-1){v=x[1];w=""}else{v=x[1].substring(0,x[1].indexOf("/"));w=x[1].substring(x[1].indexOf("/"))}var u="";if(t=="*"){u+=".*://"}else{u+=t+"://"}if(v=="*"){u+=".*"}else{if(v.indexOf("*.")===0){u+="(.+.)?"+v.substring(2)}else{u+=v}}u+=w.replace(/\*/g,".*");return"^"+u+"$"};n.tabs={open:function(u,v,w,t){if(typeof v==="function"){t=w;w=v;v=false}o.priv.call("tabs.open",{url:u,keepFocus:v},w,t)},openWithOptions:function(u,w,t){var v=undefined;if(u.pattern){u.pattern=l(u.pattern)}o.priv.call("tabs.open",u,w,t)},closeCurrent:function(t){t=arguments[1]||t;var u=n.tools.UUID();location.hash=u;o.priv.call("tabs.closeCurrent",{hash:u},null,t)}};n.tools={UUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(w){var u=Math.random()*16|0;var t=w=="x"?u:(u&3|8);return t.toString(16)}).toUpperCase()},getURL:function(u,v,t){o.priv.call("tools.getURL",{name:u.toString()},v,t)}};n.topbar={show:function(u,t){o.priv.call("topbar.show",{},u,t)},hide:function(u,t){o.priv.call("topbar.hide",{},u,t)},setTitle:function(v,u,t){o.priv.call("topbar.setTitle",{title:v},u,t)},setTitleImage:function(u,v,t){if(u&&u[0]==="/"){u=u.substr(1)}o.priv.call("topbar.setTitleImage",{icon:u},v,t)},setTint:function(t,v,u){o.priv.call("topbar.setTint",{color:t},v,u)},addButton:function(u,v,t){if(u.icon&&u.icon[0]==="/"){u.icon=u.icon.substr(1)}o.priv.call("topbar.addButton",u,function(w){v&&o.addEventListener("topbar.buttonPressed."+w,v)},t)},removeButtons:function(u,t){o.priv.call("topbar.removeButtons",{},u,t)},homePressed:{addListener:function(u,t){o.addEventListener("topbar.homePressed",u)}}};var p=[];var g=false;o.priv.get=function(){var t=JSON.stringify(p);p=[];return t};var f=[],k="zero-timeout-message";function d(t){f.push(t);window.postMessage(k,"*")}function c(t){setTimeout(t,0)}function e(t){if(t.source==window&&t.data==k){if(t.stopPropagation){t.stopPropagation()}if(f.length){f.shift()()}}}if(window.postMessage){if(window.addEventListener){window.addEventListener("message",e,true)}else{if(window.attachEvent){window.attachEvent("onmessage",e)}}window.setZeroTimeout=d}else{window.setZeroTimeout=c}o.priv.send=function(t){p.push(t);if(g&&!window.forge._flushing){window.forge._flushing=true;c(function(){window.location.href="forge://go"})}};document.addEventListener("DOMContentLoaded",function(){g=true;window.forge._flushing=true;c(function(){window.location.href="forge://go"})},false);n._get=o.priv.get;n._receive=function(){var t=arguments;if(typeof window.setZeroTimeout==="undefined"){setTimeout(function(){o.priv.receive.apply(this,t)},0)}else{c(function(){o.priv.receive.apply(this,t)})}};window.forge=n;window.forge["reload"]={updateAvailable:n.reload.updateAvailable,update:n.reload.update,applyNow:n.reload.applyNow,switchStream:n.reload.switchStream,updateReady:{addListener:n.reload.updateReady.addListener}};window.forge["ajax"]=n.request.ajax;window.forge["getPage"]=n.request.get;window.forge["createNotification"]=n.notification.create;window.forge["UUID"]=n.tools.UUID;window.forge["getURL"]=n.tools.getURL;window.forge["log"]=n.logging.log;window.forge["button"]["setUrl"]=n.button.setURL;window.forge["button"]["setBadgeText"]=n.button.setBadge;window.forge["file"]["delete"]=n.file.remove;window.forge["file"]["imageURL"]=n.file.URL})();